# 안드로이드 오디오 송신 문제 해결 보고서 (Android Audio Transmission Fix Report)

## ❌ 문제 원인 (Root Cause)

안드로이드 기기(특히 삼성 브라우저, 크롬 등)는 하드웨어 리소스 접근에 있어 PC나 iOS보다 훨씬 까다로운 제약조건(Constraints)을 가집니다.

1.  **과도한 오디오 제약조건 (OverconstrainedError)**:
    *   기존 코드는 `googEchoCancellation`, `googAutoGainControl` 등 구글 크롬 전용 고급 제약조건을 강제로 설정했습니다.
    *   일부 안드로이드 기기는 이립 하드웨어 기능이 없거나 드라이버 레벨에서 지원하지 않아, 마이크 접근 자체가 거부되거나 침묵(Silence)되기도 합니다.

2.  **보안 컨텍스트(HTTPS) 부족**:
    *   안드로이드 10+ 이상에서는 `http://` (보안되지 않은 연결)에서 마이크 접근을 강력하게 차단합니다. 로컬 네트워크 테스트 시 이를 우회해야 합니다.

3.  **코덱 미스매치**:
    *   `MediaRecorder`가 지원하는 MIME 타입을 찾지 못해 초기화에 실패하는 경우가 있습니다.

---

## ✅ 수정 사항 (Fixes Implemented)

### 1. 마이크 접근 전략 개선 (Retry Strategy)
`static/app.js` 코드를 수정하여 마이크 권한 획득을 2단계로 시도합니다.

*   **1단계 (표준 모드)**: 에코 캔슬링 등 품질 옵션을 켜고 시도합니다.
*   **2단계 (기본 모드)**: 1단계 실패 시, **모든 옵션을 끄고 `audio: true` (기본 마이크)**로만 재시도합니다.
    *   → 이를 통해 "까다로운 안드로이드 기기"에서도 일단 마이크는 켜지도록 보장합니다.

### 2. 구글 전용 옵션 제거
`goog` 접두사가 붙은 비표준 제약조건을 제거하여 호환성을 높였습니다.

### 3. MediaRecorder MIME 타입 감지 강화
브라우저가 지원하는 코덱(`webm`, `ogg`, `mp4` 등)을 순차적으로 확인하고, 지원하는 것이 없으면 브라우저 기본값을 사용하도록 변경했습니다.

---

## 📱 안드로이드 테스트 및 해결 방법 (How to Test)

1.  **가이드 폰 (서버)**:
    *   Chrome 브라우저 주소창에 `chrome://flags`를 입력합니다.
    *   `Insecure origins treated as secure` 검색.
    *   `Enable`로 변경하고, 텍스트 박스에 `http://[내_IP]:5000` (예: `http://192.168.0.5:5000`)을 입력합니다.
    *   브라우저 재실행(Relaunch).
    *   **이제 "Start Broadcast"를 누르면 마이크 권한 요청이 정상적으로 뜰 것입니다.**

2.  **관광객 폰**:
    *   관광객 폰도 동일하게 설정하거나, 가이드 폰의 핫스팟에 연결되어 있다면 보통 허용됩니다.
    *   소리가 안 들리면 화면 상단의 "Transmission Mode"가 "Manual" 인지 확인해 보세요 (WebRTC 실패 시 사용).

## 📝 파일 업데이트
*   `static/app.js`: 마이크 권한 재시도 로직 적용 완료
*   `AUDIO_DEBUG_KR.md`: 안드로이드 호환성 내용 추가 완료
