# 🛠️ 문제 해결 보고서 (Troubleshooting Report)

프로젝트 진행 중 발생한 주요 버그, 원인, 그리고 해결 방법을 기록합니다.

---

## 2026-01-10: 오디오 전송 및 호환성 (Critical)

### 1. Recorder 모드 수신 불가 (Android)
*   **증상**: 가이드가 Recorder 모드로 말해도 여행객 폰에서 소리가 안 들림.
*   **원인**:
    1.  Android 전송 코덱(`audio/webm;codecs=opus`) 헤더 문제.
    2.  전송 간격(250ms)이 너무 짧아 유효한 프레임 생성 실패.
    3.  수신측에서 'Init' 신호를 기다리며 재생을 차단함.
*   **해결**:
    *   **전송 간격 확대**: 1000ms로 늘려 안정성 확보.
    *   **코덱 최적화**: iOS 호환을 위해 MP4 우선 시도 후 WebM 사용.
    *   **수신 로직 수정**: Init 신호 없이도 데이터 수신 즉시 재생하도록 변경.

### 2. 오프라인 모드 오작동
*   **증상**: 오프라인 모드를 켜도 STT가 계속 실행되거나 재시작됨.
*   **원인**: 비동기 재시작 로직(`onend`)이 오프라인 상태 변수를 체크하지 않음.
*   **해결**: `toggleOfflineMode` 함수로 오프라인 시 STT 강제 종료 및 `onend` 이벤트에서 오프라인 상태면 재시작 차단.

---

## 2026-01-09: 서버 및 UI 로직

### 3. 역할 선택 버튼(Role Selection) 먹통
*   **증상**: 'I am Guide', 'I am Tourist' 버튼을 눌러도 반응 없음.
*   **원인**: 자바스크립트 문법 오류. `const els` 객체가 선언되기 전에 코드가 이를 참조하여 스크립트 실행이 중단됨.
*   **해결**: `els` 객체 선언부를 코드 상단으로 이동하고 중복 선언 제거.

### 4. STT 무한 재시작 (좀비 현상)
*   **증상**: Recorder 모드로 변경해도 STT가 계속 켜지며 혼선 발생.
*   **원인**: `window.audioMode` 변수의 동기화 문제로, 재시작 로직이 이전 모드(STT)라고 착각함.
*   **해결**: 전역 변수 `window.audioMode`로 상태 강제 동기화 및 `Deep Debug` 로그 추가로 상태 추적/방어.

---

## 2026-01-08: 오디오 권한 및 초기화

### 5. 안드로이드 오디오 재생 실패 (Auto-play Policy)
*   **증상**: 여행객 폰 접속 시 소리가 안 남.
*   **원인**: 모바일 브라우저는 사용자 인터랙션(터치) 없이 소리를 자동 재생하는 것을 막음.
*   **해결**:
    *   'Role Selection' 버튼 클릭 이벤트를 활용하여 미리 `AudioContext`를 `resume()` 시키는 로직 추가.
    *   무음 오디오(Silent Audio)를 백그라운드에서 재생하여 세션 유지.

---

## 2026-01-05: 데이터 및 네트워크

### 6. 장소 등록(Add Place) 실패
*   **증상**: 장소 추가 시 데이터베이스 에러 또는 반응 없음.
*   **원인**: SQLite DB 쓰기 권한 및 JSON 파싱 로직 오류.
*   **해결**: 백엔드 API 엔드포인트 수정 및 예외 처리 강화. 엑셀 업로드 포맷 표준화.